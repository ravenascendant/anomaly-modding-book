<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Script Attachments - Anomaly Modding Book</title>


        <!-- Custom HTML head -->
        <script defer data-domain="igigog.github.io" src="https://plausible.io/js/script.hash.js"></script><script defer data-domain="igigog.github.io" src="https://plausible.io/js/script.hash.js"></script>
        <script defer src="https://cloud.umami.is/script.js" data-website-id="af269dba-ec2d-471b-a4c9-44023cb64adc"></script>

        <meta name="description" content="Introductory book for S.T.A.L.K.E.R. Anomaly modding">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/custom.css">
        <link rel="stylesheet" href="../../theme/css/tables.css">
        <link rel="stylesheet" href="../../theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/css/whichlang.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anomaly Modding Book</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/Igigog/anomaly-modding-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Igigog/anomaly-modding-book/edit/main/src/tutorials/scripting/script-attachments.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="script-attachments"><a class="header" href="#script-attachments">Script Attachments</a></h1>
<hr />
<h2 id="basics"><a class="header" href="#basics">Basics</a></h2>
<p>Script attachments are used to attach any model to any game object or even other script attachments.<br />
This opens up a lot of possibilities like weapon attachments no longer having to be part of the weapon model and much more.</p>
<p>Script attachments are managed entirely by scripts, the engine does not store any attachment data in save files.<br />
This means youâ€™ll have to keep track of your attachments and store serialized data of them in mdata if you want them to persist throughout saves.<br />
Or find other means to reliably attach/remove them, like <code>actor_item_to_slot</code> and <code>actor_item_to_ruck</code> callbacks.</p>
<h3 id="creating-a-script-attachment"><a class="header" href="#creating-a-script-attachment">Creating a script attachment</a></h3>
<p>All you need to create a script attachment is a parent game_object/attachment and the model you want to use.<br />
One simple line will create the script attachment and attach it to its parent:</p>
<pre><code class="language-lua">local test_att = db.actor:add_attachment("name", "path\\to\\model")
</code></pre>
<p>This adds a new script attachment with the name <code>name</code> the actor game_object using the model we specified.<br />
Attachments can have any name and creating an attachment with a name that is already used by an attachment will delete the previous attachment.</p>
<p>You can also attach attachments to other attachments:</p>
<pre><code class="language-lua">local child_att = test_att:add_attachment("child", "path\\to\\other_model")
local child_child_att = child_attachment:add_attachment("child_child", "path\\to\\another_model")
</code></pre>
<h3 id="how-do-i-remove-them"><a class="header" href="#how-do-i-remove-them">How do I remove them?</a></h3>
<p>If you want to remove an attachment, just remove it from its parent:</p>
<pre><code class="language-lua">test_att:remove_attachment("child")
child_att = nil
child_child_att = nil
</code></pre>
<p>This will remove the <code>child_att</code> with the name <code>child</code> we previously added to <code>test_att</code>.<br />
Any child attachments of <code>child_att</code> will be removed as well.<br />
Make sure you donâ€™t keep references to deleted attachments in your scripts or you might get pure virtual function errors, similar to storing a reference to a destroyed game_object.</p>
<p><code>remove_attachment</code> also accepts script_attachment objects, so itâ€™s possible to do this:</p>
<pre><code class="language-lua">test_att:remove_attachment(child_att)
child_att = nil
child_child_att = nil
</code></pre>
<h3 id="accessing-script-attachments-without-a-reference"><a class="header" href="#accessing-script-attachments-without-a-reference">Accessing script attachments without a reference</a></h3>
<p>Itâ€™s possible to access a script attachment without it being stored in a variable.
You can access it using its name:</p>
<pre><code class="language-lua">db.actor:get_attachment("name")
</code></pre>
<p>Another way to get all of the attachments of an object or script attachment is by <a href="script-attachments.html#iterating-attachments">iterating them</a>.</p>
<h3 id="types"><a class="header" href="#types">Types</a></h3>
<p>Methods like <code>set_parent_bone</code> rely on the type (to choose the correct parent hud or world model).<br />
This means that the type should be the first thing to set after adding an attachment.<br />
By default the type is set to <code>World</code>, which means a new attachment will render on the world model of its parent object.</p>
<p>At the moment there are three types (or rendering modes) of script attachments.</p>
<pre><code class="language-lua">script_attachment_type = {
	["Hud"]         = 0,
	["World"]       = 1,
	["CamAttached"] = 2,
}
</code></pre>
<p>Using getter/setter we can read and change the attachment type:</p>
<pre><code class="language-lua">get_type()
set_type(number)
</code></pre>
<p>If we want the attachment to render in hud mode, we can do it as follows:</p>
<pre><code class="language-lua">test_att:set_type(0)
-- or
test_att:set_type(script_attachment_type.Hud)
</code></pre>
<h3 id="cam-attached"><a class="header" href="#cam-attached">Cam attached?</a></h3>
<p>Another very cool aspect of script attachments is the ability to have them attach to the player camera.
Setting the flags value to <code>2</code> (<code>script_attachment_type.CamAttached</code>) will enable this behavior.</p>
<p>When attached to the camera, the attachment will follow the position and direction of the first person camera and render at a fixed fov, so it should look similar on all resolutions and fov values.<br />
This is especially useful for things like 3D UIs or visible 3D helmets and gasmasks.</p>
<h3 id="attachment-names"><a class="header" href="#attachment-names">Attachment names</a></h3>
<p>The name of an attachment can be read or set at any time:</p>
<pre><code class="language-lua">test_att:get_name()
test_att:set_name("new_name")
</code></pre>
<h3 id="getting-and-setting-parent"><a class="header" href="#getting-and-setting-parent">Getting and setting parent</a></h3>
<p>If you need the parent object or parent attachment of an attachment for whatever reason, itâ€™s possible to access it like this:</p>
<pre><code class="language-lua">local parent_tbl = test_att:get_parent()
</code></pre>
<p>Weâ€™ll receive a table, that looks like this:</p>
<pre><code class="language-lua">parent_tbl = {
	["object"] = userdata, -- (reference to db.actor)
	["attachment"] = nil
}
</code></pre>
<p>Now we know that the attachment is attached to a game_object and we have a reference to said game_object.</p>
<pre><code class="language-lua">local parent_tbl = test_att:get_parent()
if parent_tbl.object then
	-- will print "parent is actor"
	printf("parent is %s", parent_tbl.object:section())
elseif parent_tbl.attachment then
	printf("parent is %s", parent_tbl.attachment:get_name())
end
</code></pre>
<p>Maybe you want to transfer your script attachment to another parent game_object or attachment?
Just use <code>set_parent</code>, it will transfer the attachment, as well as any child attachments to the new parent:</p>
<pre><code class="language-lua">test_att:set_parent(npc)
</code></pre>
<p><strong>The attachment will overwrite an existing attachment of the new parent object, if it uses the same name!</strong>
<em>(Might get changed in the future)</em></p>
<h3 id="parent-bone"><a class="header" href="#parent-bone">Parent Bone</a></h3>
<p><strong>Make sure you have set the correct attachment type first or you might get wrong results because the engine tries to find the bone in the parent world model instead of its hud model.</strong></p>
<p>By default the script attachment will attach to the root bone (bone 0) of the parent game_object or attachment.
You can change the parent bone at any time using</p>
<pre><code class="language-lua">test_att:set_parent_bone(15)
-- or
test_att:set_parent_bone("bip01_head")
</code></pre>
<p>In this case it will set the parent bone to <code>bip01_head</code> of the parent npc object.
Changing to a bone that doesnâ€™t exist will default to the root bone.</p>
<p>To get the current parent bone id you can use</p>
<pre><code class="language-lua">local bone_id = test_att:get_parent_bone()
</code></pre>
<hr />
<h2 id="attachment-position-rotation-and-scale"><a class="header" href="#attachment-position-rotation-and-scale">Attachment position, rotation and scale</a></h2>
<p>Position and rotation work as an offset to the parent boneâ€™s position and rotation.
Functions support both vectors and three numbers.<br />
Scale can even be set with a single number, if the scale should be the same in all directions.</p>
<h3 id="position"><a class="header" href="#position">Position</a></h3>
<pre><code class="language-lua">get_position() -- returns vector
set_position(vector)
set_position(number, number, number)
</code></pre>
<h3 id="rotation"><a class="header" href="#rotation">Rotation</a></h3>
<pre><code class="language-lua">get_rotation() -- returns vector
set_rotation(vector)
set_rotation(number, number, number)
</code></pre>
<h3 id="scale"><a class="header" href="#scale">Scale</a></h3>
<pre><code class="language-lua">get_scale() -- returns vector
set_scale(vector)
set_scale(number, number, number)
set_scale(number)
</code></pre>
<h3 id="attachment-origin"><a class="header" href="#attachment-origin">Attachment origin</a></h3>
<pre><code class="language-lua">get_origin() -- returns vector
set_origin(vector)
set_origin(number, number, number)
</code></pre>
<p>You can change the origin point of an attachment.<br />
By default the root bone of the attachment will be used as its origin point.</p>
<p>Say, you want to rotate the attachment around its center, instead of its root bone:</p>
<pre><code class="language-lua">local center = test_att:get_center()
test_att:set_origin(center)
</code></pre>
<p><code>get_center()</code> can be used to get the center position of an attachment model (also works on game objects).</p>
<hr />
<h2 id="attachment-model"><a class="header" href="#attachment-model">Attachment model</a></h2>
<p>To get the path of the model that is currently used for a script attachment use</p>
<pre><code class="language-lua">local path = test_att:get_model()
</code></pre>
<p>The model can be changed at any time</p>
<pre><code class="language-lua">test_att:set_model("path\\to\\new_model", false)
</code></pre>
<p>The boolean tells the engine if existing bone callbacks should be kept in place.<br />
You can find out more about bone callbacks <a href="script-attachments.html#bone-callbacks">down below</a>.</p>
<h3 id="model-bones"><a class="header" href="#model-bones">Model bones</a></h3>
<p>The bone methods are similar to the ones we have for game_objects, accepting both IDs and bone names:</p>
<pre><code class="language-lua">bone_id(string)
bone_name(number)
bone_visible(number)
bone_visible(string)
bone_visible(number, boolean, boolean)
bone_visible(string, boolean, boolean)
bone_transform(number)
bone_transform(string)
bone_position(number)
bone_position(string)
bone_direction(number)
bone_direction(string)
bone_parent(number)
bone_parent(string)
set_parent_bone(number);
set_parent_bone(string);
get_parent_bone();
list_bones()
</code></pre>
<h3 id="animations"><a class="header" href="#animations">Animations</a></h3>
<p>If the model contains any motions or motion references, you can play them on the attachment model.<br />
<strong>By default the engine will try to play the <code>idle</code> motion, so itâ€™s advised to always add one to your model if youâ€™re exporting it as a dynamic model.</strong></p>
<pre><code class="language-lua">         -- Name    MixIn    Speed
play_motion(string, boolean, number)
</code></pre>
<p><br />
Example</p>
<pre><code class="language-lua">-- returns animation length in milliseconds
local anm_length = test_att:play_motion("reload", false, 1)

-- if you want to stop the motion, just play "idle"
-- if the animation is not looped, it will automatically play "idle" at the end
test_att:play_motion("idle", true, 1)
</code></pre>
<hr />
<h2 id="bone-callbacks"><a class="header" href="#bone-callbacks">Bone Callbacks</a></h2>
<p>Bone callbacks are a powerful feature, they allow you to change the position of any bone of the attachment model in real time.<br />
There are two types of bone callbacks.</p>
<h3 id="copy-bone-callback"><a class="header" href="#copy-bone-callback">Copy Bone Callback</a></h3>
<p>The first type of bone callbacks simply copies the position of a bone of the parent game_object/attachment and moves the selected attachment bone to that position.
Itâ€™s mainly useful if you want to attach something with multiple bones to a parent object and have it follow its animations.</p>
<p>Usage</p>
<pre><code class="language-lua">test_att:bone_callback(attachment_bone, parent_bone, true)
-- attachment_bone is the name or ID of the bone of the attachment model we want to modify
-- parent_bone is the name or ID of the bone of the parent model we want to copy
-- setting the boolean to true tells the engine that we don't need to calculate
-- animations for this bone (on the attachment model) - mainly for performance reasons
</code></pre>
<p><br />
For example we can add an exoskeleton to the player model like this</p>
<pre><code class="language-lua">-- attach exo model
local exo_n = db.actor:add_attachment("exoskeleton_body", ogf_file_npc)

-- set bone callbacks
-- you can do for i=0,46
-- i'm just copying the bones that are actually used by the exo model
for i=0,14 do
	exo_n:bone_callback(i,i,true)
end

for i=20,22 do
	exo_n:bone_callback(i,i,true)
end

for i=33,35 do
	exo_n:bone_callback(i,i,true)
end
</code></pre>
<p><strong>You have to set the callback for bone 0 on actor, stalker and mutant models, otherwise the attachment will awkwardly shift around sometimes due to foot IK.</strong><br />
<br />
<br />
Attaching something to the first person hands is a little more involved.<br />
Since left and right arms use seperate models, we have to attach two script attachments:</p>
<pre><code class="language-lua">local exo_r = db.actor:add_attachment("exoskeleton_right_arm", ogf_file)

-- set hud mode first
exo_r:set_type(script_attachment_type.Hud)

-- an attachment for the right arm has to use a bone of the right arm as its parent bone
exo_r:set_parent_bone("r_clavicle")

-- the model I'm using is for both arms so we have to hide the left part
exo_r:set_bone_visible("l_clavicle", false, true)

-- we also need a bone callback to copy the root bone
exo_r:bone_callback(0,0,true)

-- copy the rest of the right arm bones
for i=21,41 do
	exo_r:bone_callback(i,i,true)
end


-- attaching to the left arm is simpler
local exo_l = db.actor:add_attachment("exoskeleton_left_arm", ogf_file)

-- set hud mode
exo_l:set_type(script_attachment_type.Hud)

-- hide right part
exo_l:set_bone_visible("r_clavicle", false, true)

-- copy left arm bones
for i=0,20 do
	exo_l:bone_callback(i,i,true)
end
</code></pre>
<h3 id="script-bone-callback"><a class="header" href="#script-bone-callback">Script Bone Callback</a></h3>
<p>The second type of bone callbacks uses a lua function to modify the final position of a bone.<br />
It is called each frame so donâ€™t use too many of them if you can avoid it :)</p>
<p>We need a function for our callback.<br />
It takes the matrix of the bone and does calculations on it to modify the final bone matrix.<br />
See the following example from the lockpick UI</p>
<pre><code class="language-lua">function cylinder_callback(mat)
	-- temp copy of position since setHPB overwrites it
	local temp = mat.c
	local hpb = mat:getHPB()
	-- apply our rotation
	mat:setHPB(hpb.x, hpb.y + cylinder_rotation, hpb.z)
	-- revert to saved position
	mat.c = temp
	-- return modified matrix to the engine
	return mat
end
</code></pre>
<p><br />
Since we want the cylinder_rotation to be applied on top of an animated lock, we donâ€™t disable animation calculation this time (third argument is <code>false</code>).</p>
<pre><code class="language-lua">lockpicker:bone_callback(1, cylinder_callback, false)
</code></pre>
<h3 id="removing-bone-callbacks"><a class="header" href="#removing-bone-callbacks">Removing Bone Callbacks</a></h3>
<p>Bone callbacks can be removed like this</p>
<pre><code class="language-lua">-- remove bone callback from bone with ID 1
lockpicker:remove_bone_callback(1)
</code></pre>
<h3 id="persisting-through-model-change"><a class="header" href="#persisting-through-model-change">Persisting through model change</a></h3>
<p>As mentioned before, you can tell the engine to keep existing bone callbacks in place when changing the attachment model by setting the second argument to true in <code>set_model</code></p>
<pre><code class="language-lua">lockpicker:set_model("path\\to\\other_lock", true)
</code></pre>
<hr />
<h2 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h2>
<h3 id="attaching-script-ui"><a class="header" href="#attaching-script-ui">Attaching Script UI</a></h3>
<p>Another nice to have feature, you can attach script 3D UI to attachments (UI like on the dosimeter or rf receiver)<br />
Check <code>gamedata\scripts\ui_dosimeter.script</code> to see how script 3D UI works.</p>
<p>Available functions:</p>
<pre><code class="language-lua">get_ui()
get_ui_bone()
get_ui_rotation()

set_ui(string)
set_ui_bone(number)
set_ui_bone(string)
set_ui_position(vector)
set_ui_position(number, number, number)
set_ui_position()
set_ui_rotation(vector)
set_ui_rotation(number, number, number)
</code></pre>
<p><br />
Letâ€™s say, we want to display the dosimeter UI on the attachment model:</p>
<pre><code class="language-lua">test_att:set_ui("ui_dosimeter.get_UI")
test_att:set_ui_bone(5)
test_att:set_ui_position(0,0.1,0)
test_att:set_ui_rotation(90,0,0)
</code></pre>
<p><br />
You can even change the scale of the UI using bone callbacks!<br />
Just change the scale of the bone the UI is attached to.<br />
<em>(Better use a bone that is not actually used by the model, or youâ€™ll scale a part of it.)</em></p>
<pre><code class="language-lua">test_att:bone_callback(5, scale_func, false)

local scale_mat = matrix():scale(1.5, 1.5, 1.5)

function scale_func(mat)
	mat:mulA_43(scale_mat)
	return mat
end
</code></pre>
<h3 id="attaching-script-lights"><a class="header" href="#attaching-script-lights">Attaching Script Lights</a></h3>
<p>First create an attachment_script_light, it can use the same functions and properties as a regular script_light.<br />
<em>(Make sure to keep a reference to the script light or it will be garbage collected)</em></p>
<pre><code class="language-lua">att_light = attachment_script_light()
att_light.type = 2
att_light.hud_mode = true
att_light:set_cone(math.rad(0.5))
att_light.color = fcolor():set(1,0,0,1)
</code></pre>
<p><br />
attachment_script_light position and direction work as an offset to the attachment position/direction</p>
<pre><code class="language-lua">att_light:set_position(0,0,2)
att_light:set_direction(0,90,0)
</code></pre>
<p><br />
Finally use <code>attach_light</code> to attach the light to your script attachment</p>
<pre><code class="language-lua">att:attach_light(att_light)
</code></pre>
<p><br />
Similar to script 3D UI you can get/set which bone the light is attached to</p>
<pre><code class="language-lua">set_light_bone(number)
set_light_bone(string)
get_light_bone()
</code></pre>
<p><br />
If you donâ€™t have a reference to the attached light you can get one using</p>
<pre><code class="language-lua">att_light = att:get_light()
</code></pre>
<h3 id="iterating-attachments"><a class="header" href="#iterating-attachments">Iterating attachments</a></h3>
<p>Similar to inventories, itâ€™s possible to iterate all attachments of an object or attachment<br />
This example prints the name, followed by the model of every attachment attached to <code>obj</code>.</p>
<pre><code class="language-lua">local function it_att(name, attachment)
	printf(name)
	printf(attachment:get_model())
	
	-- you can return true to exit the iteration early
	if (name == "my_attachment") then return true end
end
obj:iterate_attachments(it_att)
</code></pre>
<h4 id="have-fun"><a class="header" href="#have-fun">Have fun!</a></h4>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../tutorials/scripting/script-animations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../tutorials/scripting/imgui.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../tutorials/scripting/script-animations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../tutorials/scripting/imgui.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/js/tables.js"></script>
        <script src="../../theme/js/mermaid.min.js"></script>
        <script src="../../theme/js/mermaid-init.js"></script>
        <script src="../../theme/js/whichlang.js"></script>


    </div>
    </body>
</html>
